import{a as ae,r as d,q as le,o as re,w as ie,n as z,p as ne,j as e,m,e as w,f as v,g as de,v as M,B as oe,h as ce,i as me}from"./index-iXPhoPzz.js";import{M as xe}from"./products-ltJaewHY.js";function be(){const{currentUser:n}=ae(),[K,B]=d.useState(!0),[O,b]=d.useState(""),[Q,C]=d.useState(!1),[l,T]=d.useState({name:"",address:"",postalCode:"",country:"",gender:"",billingName:"",billingAddress:"",billingPostalCode:"",billingCountry:""}),[y,G]=d.useState(null),[A,E]=d.useState(""),[$,q]=d.useState([]),[x,k]=d.useState(!1),[c,Z]=d.useState({}),P=d.useRef(null),[f,S]=d.useState([]),[_,p]=d.useState(!0),[H,F]=d.useState(null),[R,I]=d.useState(null),[J,D]=d.useState(""),[L,j]=d.useState(""),[Y,W]=d.useState(!1);d.useEffect(()=>{async function t(){if(n){C(!1),b(""),B(!0);try{const a=w(v,"users",n.uid),i=await de(a),s=i.exists()?i.data():{};T({name:s.name||n.displayName||"",address:s.address||"",postalCode:s.postalCode||"",country:s.country||"",gender:s.gender||"",billingName:s.billingName||s.name||n.displayName||"",billingAddress:s.billingAddress||s.address||"",billingPostalCode:s.billingPostalCode||s.postalCode||"",billingCountry:s.billingCountry||s.country||""}),E(s.photoURL||n.photoURL||""),q(Array.isArray(s.favorites)?s.favorites:[])}catch{b("Failed to load profile")}finally{k(!1),B(!1)}}}t()},[n]),d.useEffect(()=>{if(!n){S([]),p(!1);return}p(!0);const t=le(z(v,"orders"),ie("userId","==",n.uid),re("createdAt","desc")),a=ne(t,i=>{const s=i.docs.map(r=>({id:r.id,...r.data()}));S(s),p(!1)},()=>{S([]),p(!1)});return()=>a()},[n]);function u(t){const{name:a,value:i}=t.target;T(s=>({...s,[a]:i}))}function V(){const t={},a=l.name.trim();a?a.length<2&&(t.name="Full name must be at least 2 characters"):t.name="Full name is required";const i=l.address.trim();i&&i.length<5&&(t.address="Address should be at least 5 characters");const s=l.billingName.trim();s&&s.length<2&&(t.billingName="Billing name should be at least 2 characters");const r=l.billingAddress.trim();r&&r.length<5&&(t.billingAddress="Billing address should be at least 5 characters");function o(U,N){const g=U.trim();g&&((g.length<3||g.length>10)&&(t[N]="Postal code should be 3 to 10 characters"),/^[0-9A-Za-z\- ]+$/.test(g)||(t[N]="Postal code can use letters and numbers only"))}o(l.postalCode,"postalCode"),o(l.billingPostalCode,"billingPostalCode");function h(U,N){const g=U.trim();g&&g.length<2&&(t[N]="Country name should be at least 2 characters")}return h(l.country,"country"),h(l.billingCountry,"billingCountry"),Z(t),Object.keys(t).length===0}function X(t){return new Promise((a,i)=>{const s=new FileReader;s.onload=()=>a(s.result),s.onerror=i,s.readAsDataURL(t)})}async function ee(t){if(t.preventDefault(),b(""),C(!1),!!V())try{let i=A;if(y){if(!y.type.startsWith("image/")){b("Please upload a valid image file");return}if(y.size>256*1024){b("Image too large (max 256KB)");return}i=await X(y)}const s=w(v,"users",n.uid);await M(s,{name:l.name,address:l.address,postalCode:l.postalCode,country:l.country,gender:l.gender,billingName:l.billingName,billingAddress:l.billingAddress,billingPostalCode:l.billingPostalCode,billingCountry:l.billingCountry,photoURL:i||null},{merge:!0});const r={};if(l.name&&l.name!==n.displayName&&(r.displayName=l.name),Object.keys(r).length)try{await oe(n,r)}catch{}E(i),C(!0),k(!1)}catch{b("Failed to save profile")}}async function te(t){if(n)try{const a=w(v,"users",n.uid);await ce(a,{favorites:me(t)}),q(i=>i.filter(s=>s!==t))}catch(a){console.error("Failed to remove favorite",a)}}async function se(t,a){if(!n||!t||!a)return;const i=L.trim();if(i){W(!0);try{const s=z(v,"reviews"),o=l.name||n.displayName||""||n.email||"Anonymous";await M(w(s),{productId:a.id,productName:a.name||"",userId:n.uid,userName:o,message:i,createdAt:new Date,orderId:t.id||null}),j(""),F(null),I(null),D("")}catch(s){console.error("Failed to submit review",s)}finally{W(!1)}}}return n?e.jsxs("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs(m.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},className:"relative",children:[e.jsx(m.div,{"aria-hidden":"true",className:"pointer-events-none absolute -inset-x-10 -top-10 h-40 bg-gradient-to-r from-love-light/60 via-white to-love-light/60 blur-3xl opacity-60",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.7}}),e.jsx(m.div,{layout:!0,className:"bg-white p-8 rounded-2xl shadow-lg border border-love-pink/20 relative overflow-hidden",whileHover:{y:-2},transition:{type:"spring",stiffness:260,damping:22},children:K?e.jsx("div",{className:"text-gray-600",children:"Loading..."}):e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(m.h2,{className:"text-2xl font-cursive text-love-dark",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4},children:"Personal Details"}),e.jsx(m.button,{type:"button",onClick:()=>k(t=>!t),className:"px-4 py-2 text-sm font-medium rounded-lg border border-love-red text-love-red hover:bg-love-red hover:text-white transition-colors",whileTap:{scale:.95},whileHover:{translateY:-1},transition:{type:"spring",stiffness:300,damping:20},children:x?"Cancel":"Update Personal Details"})]}),O&&e.jsx("div",{className:"bg-red-100 text-red-700 p-3 rounded",children:O}),Q&&e.jsx(m.div,{className:"bg-green-100 text-green-700 p-3 rounded inline-flex items-center gap-2",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:280,damping:18},children:e.jsx("span",{children:"Saved"})}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(m.div,{className:"w-20 h-20 rounded-full overflow-hidden bg-love-light border border-love-pink/30 ring-2 ring-love-light/60",whileHover:{scale:1.03,rotate:1.5},transition:{type:"spring",stiffness:260,damping:18},children:A?e.jsx("img",{src:A,alt:"Avatar",loading:"lazy",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"No Image"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold text-love-dark",children:l.name||n.displayName||"No name set"}),e.jsx("div",{className:"text-sm text-gray-500",children:n.email})]})]}),x&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("input",{ref:P,type:"file",accept:"image/*",onChange:t=>{var a;return G(((a=t.target.files)==null?void 0:a[0])||null)},className:"hidden"}),e.jsx(m.button,{type:"button",onClick:()=>P.current&&P.current.click(),className:"px-4 py-2 text-sm font-medium rounded-lg bg-love-light text-love-dark hover:bg-love-pink/40 transition-colors",whileTap:{scale:.95},children:"Change Photo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.name,onChange:u,disabled:!x}),c.name&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",name:"address",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.address,onChange:u,disabled:!x}),c.address&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.address})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Postal Code"}),e.jsx("input",{type:"text",name:"postalCode",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.postalCode,onChange:u,disabled:!x}),c.postalCode&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.postalCode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",name:"country",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.country,onChange:u,disabled:!x}),c.country&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.country})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{name:"gender",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.gender,onChange:u,disabled:!x,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-2xl font-cursive text-love-dark",children:"Billing Details"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Name"}),e.jsx("input",{type:"text",name:"billingName",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.billingName,onChange:u,disabled:!x}),c.billingName&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.billingName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Address"}),e.jsx("input",{type:"text",name:"billingAddress",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.billingAddress,onChange:u,disabled:!x}),c.billingAddress&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.billingAddress})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Postal Code"}),e.jsx("input",{type:"text",name:"billingPostalCode",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.billingPostalCode,onChange:u,disabled:!x}),c.billingPostalCode&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.billingPostalCode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Country"}),e.jsx("input",{type:"text",name:"billingCountry",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.billingCountry,onChange:u,disabled:!x}),c.billingCountry&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:c.billingCountry})]})]})]})]}),x&&e.jsx(m.button,{type:"submit",className:"w-full bg-love-red text-white py-3 rounded-lg font-medium hover:bg-red-700 transition-colors shadow-lg",whileTap:{scale:.97},whileHover:{translateY:-1},children:"Save"})]})})]}),e.jsx(m.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1,ease:[.16,1,.3,1]},children:e.jsxs(m.div,{layout:!0,className:"bg-white p-8 rounded-2xl shadow-lg border border-love-pink/20 mt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-love-dark mb-4",children:"Your Favorites"}),$.length===0?e.jsx("div",{className:"text-gray-600",children:"No favorites yet. Tap the heart on items to save them here."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:xe.filter(t=>$.includes(t.id)).map((t,a)=>e.jsxs(m.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05*a},whileHover:{y:-4,boxShadow:"0 18px 35px rgba(15,23,42,0.16)"},className:"border border-love-pink/20 rounded-xl overflow-hidden bg-white shadow-sm flex flex-col",children:[e.jsx(m.img,{src:t.image,alt:t.name,className:"w-full h-40 object-cover",whileHover:{scale:1.03},transition:{type:"spring",stiffness:260,damping:22}}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"text-xs text-love-red font-medium mb-1 uppercase tracking-wider",children:t.category}),e.jsx("div",{className:"font-semibold text-gray-800",children:t.name}),e.jsxs("div",{className:"text-love-dark font-bold mt-2 mb-4",children:["$",t.price.toFixed(2)]}),e.jsx(m.button,{type:"button",onClick:()=>te(t.id),className:"mt-auto inline-flex items-center justify-center px-3 py-2 rounded-lg text-xs font-medium border border-gray-300 text-gray-700 hover:border-love-red hover:text-love-red transition-colors",whileTap:{scale:.95},children:"Remove from favorites"})]})]},t.id))})]})}),e.jsx(m.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,delay:.15,ease:[.16,1,.3,1]},children:e.jsxs(m.div,{layout:!0,className:"bg-white p-8 rounded-2xl shadow-lg border border-love-pink/20 mt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-love-dark mb-4",children:"Your Orders"}),_?e.jsx("div",{className:"text-gray-600 text-sm",children:"Loading your orders..."}):f.length===0?e.jsx("div",{className:"text-gray-600 text-sm",children:"You have not placed any orders yet."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"In progress"}),e.jsxs("div",{className:"space-y-3",children:[f.filter(t=>(t.status||"pending")!=="delivered").length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No active orders."}),f.filter(t=>(t.status||"pending")!=="delivered").map(t=>{const a=(t.status||"pending").toLowerCase(),i=t.createdAt&&t.createdAt.toDate?t.createdAt.toDate().toLocaleString():"—",s=Number(t.total||0).toFixed(2),r=Array.isArray(t.items)?t.items:[],o=r[0],h=r.length>1?r.length-1:0;return e.jsxs("div",{className:"border border-gray-100 rounded-2xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-mono text-gray-500 truncate max-w-[220px]",children:t.id}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Placed on ",i]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-love-dark",children:["$",s]}),e.jsx("div",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-medium "+(a==="pending"?"bg-yellow-100 text-yellow-800":a==="processing"?"bg-blue-100 text-blue-800":a==="shipped"?"bg-indigo-100 text-indigo-800":a==="cancelled"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:a[0].toUpperCase()+a.slice(1)})]})]}),o&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-gray-200 flex-shrink-0 bg-white",children:o.image?e.jsx("img",{src:o.image,alt:o.name||"Item",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-[10px] text-gray-400",children:"No image"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 truncate",children:o.name||"Item"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Qty ",o.quantity||1," • $",Number(o.price||0).toFixed(2)]}),h>0&&e.jsxs("div",{className:"text-[11px] text-gray-500",children:["+ ",h," more item",h>1?"s":""]})]})]})]},t.id)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Completed orders"}),e.jsxs("div",{className:"space-y-4",children:[f.filter(t=>(t.status||"pending")==="delivered").length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No completed orders yet."}),f.filter(t=>(t.status||"pending")==="delivered").map(t=>{const a=t.createdAt&&t.createdAt.toDate?t.createdAt.toDate().toLocaleString():"—",i=Number(t.total||0).toFixed(2),s=Array.isArray(t.items)?t.items:[];return e.jsxs("div",{className:"border border-gray-100 rounded-2xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-mono text-gray-500 truncate max-w-[220px]",children:t.id}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Placed on ",a]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-love-dark",children:["$",i]}),e.jsx("div",{className:"text-[11px] text-green-700 bg-green-100 inline-flex px-2 py-0.5 rounded-full mt-1",children:"Delivered"})]})]}),s.length>0&&e.jsx("div",{className:"space-y-3",children:s.map((r,o)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-gray-200 flex-shrink-0 bg-white",children:r.image?e.jsx("img",{src:r.image,alt:r.name||"Item",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-[10px] text-gray-400",children:"No image"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 truncate",children:r.name||"Item"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Qty ",r.quantity||1," • $",Number(r.price||0).toFixed(2)]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1",children:e.jsx("button",{type:"button",onClick:()=>{F(t.id),I(r.id),D(r.name||""),j("")},className:"px-3 py-1.5 rounded-lg border border-gray-300 text-xs font-medium text-gray-700 hover:border-love-red hover:text-love-red transition-colors",children:H===t.id&&R===r.id?"Writing...":"Write review"})})]},`${t.id}-${o}`))}),H===t.id&&R&&e.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-1",children:["Review for ",J||"item"]}),e.jsx("textarea",{rows:3,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",placeholder:"Write a short message about this item...",value:L,onChange:r=>j(r.target.value)}),e.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{F(null),I(null),D(""),j("")},className:"px-3 py-1.5 rounded-lg border border-gray-300 text-xs text-gray-600 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",disabled:Y||!L.trim(),onClick:()=>{const r=(Array.isArray(t.items)?t.items:[]).find(o=>o&&o.id===R);se(t,r)},className:"px-4 py-1.5 rounded-lg bg-love-red text-white text-xs font-medium hover:bg-red-700 disabled:opacity-60 disabled:cursor-not-allowed",children:Y?"Saving...":"Submit review"})]})]})]},t.id)})]})]})]})]})})]}):null}export{be as default};
