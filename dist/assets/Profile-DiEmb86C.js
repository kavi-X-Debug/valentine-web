import{a as I,r as c,j as e,m as o,e as N,f as w,g as M,y as Y,z as q,h as K,i as $}from"./index-zv41U5i8.js";import{M as G}from"./products-ltJaewHY.js";function _(){const{currentUser:n}=I(),[D,C]=c.useState(!0),[k,g]=c.useState(""),[B,h]=c.useState(!1),[t,P]=c.useState({name:"",address:"",postalCode:"",country:"",gender:"",billingName:"",billingAddress:"",billingPostalCode:"",billingCountry:""}),[b,L]=c.useState(null),[p,A]=c.useState(""),[F,S]=c.useState([]),[d,y]=c.useState(!1),[r,E]=c.useState({}),v=c.useRef(null);c.useEffect(()=>{async function s(){if(n){h(!1),g(""),C(!0);try{const a=N(w,"users",n.uid),i=await M(a),l=i.exists()?i.data():{};P({name:l.name||n.displayName||"",address:l.address||"",postalCode:l.postalCode||"",country:l.country||"",gender:l.gender||"",billingName:l.billingName||l.name||n.displayName||"",billingAddress:l.billingAddress||l.address||"",billingPostalCode:l.billingPostalCode||l.postalCode||"",billingCountry:l.billingCountry||l.country||""}),A(l.photoURL||n.photoURL||""),S(Array.isArray(l.favorites)?l.favorites:[])}catch{g("Failed to load profile")}finally{y(!1),C(!1)}}}s()},[n]);function m(s){const{name:a,value:i}=s.target;P(l=>({...l,[a]:i}))}function T(){const s={},a=t.name.trim();a?a.length<2&&(s.name="Full name must be at least 2 characters"):s.name="Full name is required";const i=t.address.trim();i&&i.length<5&&(s.address="Address should be at least 5 characters");const l=t.billingName.trim();l&&l.length<2&&(s.billingName="Billing name should be at least 2 characters");const x=t.billingAddress.trim();x&&x.length<5&&(s.billingAddress="Billing address should be at least 5 characters");function R(j,f){const u=j.trim();u&&((u.length<3||u.length>10)&&(s[f]="Postal code should be 3 to 10 characters"),/^[0-9A-Za-z\- ]+$/.test(u)||(s[f]="Postal code can use letters and numbers only"))}R(t.postalCode,"postalCode"),R(t.billingPostalCode,"billingPostalCode");function U(j,f){const u=j.trim();u&&u.length<2&&(s[f]="Country name should be at least 2 characters")}return U(t.country,"country"),U(t.billingCountry,"billingCountry"),E(s),Object.keys(s).length===0}function H(s){return new Promise((a,i)=>{const l=new FileReader;l.onload=()=>a(l.result),l.onerror=i,l.readAsDataURL(s)})}async function O(s){if(s.preventDefault(),g(""),h(!1),!!T())try{let i=p;if(b){if(!b.type.startsWith("image/")){g("Please upload a valid image file");return}if(b.size>256*1024){g("Image too large (max 256KB)");return}i=await H(b)}const l=N(w,"users",n.uid);await Y(l,{name:t.name,address:t.address,postalCode:t.postalCode,country:t.country,gender:t.gender,billingName:t.billingName,billingAddress:t.billingAddress,billingPostalCode:t.billingPostalCode,billingCountry:t.billingCountry,photoURL:i||null},{merge:!0});const x={};if(t.name&&t.name!==n.displayName&&(x.displayName=t.name),Object.keys(x).length)try{await q(n,x)}catch{}A(i),h(!0),y(!1)}catch{g("Failed to save profile")}}async function z(s){if(n)try{const a=N(w,"users",n.uid);await K(a,{favorites:$(s)}),S(i=>i.filter(l=>l!==s))}catch(a){console.error("Failed to remove favorite",a)}}return n?e.jsxs("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs(o.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},className:"relative",children:[e.jsx(o.div,{"aria-hidden":"true",className:"pointer-events-none absolute -inset-x-10 -top-10 h-40 bg-gradient-to-r from-love-light/60 via-white to-love-light/60 blur-3xl opacity-60",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.7}}),e.jsx(o.div,{layout:!0,className:"bg-white p-8 rounded-2xl shadow-lg border border-love-pink/20 relative overflow-hidden",whileHover:{y:-2},transition:{type:"spring",stiffness:260,damping:22},children:D?e.jsx("div",{className:"text-gray-600",children:"Loading..."}):e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(o.h2,{className:"text-2xl font-cursive text-love-dark",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4},children:"Personal Details"}),e.jsx(o.button,{type:"button",onClick:()=>y(s=>!s),className:"px-4 py-2 text-sm font-medium rounded-lg border border-love-red text-love-red hover:bg-love-red hover:text-white transition-colors",whileTap:{scale:.95},whileHover:{translateY:-1},transition:{type:"spring",stiffness:300,damping:20},children:d?"Cancel":"Update Personal Details"})]}),k&&e.jsx("div",{className:"bg-red-100 text-red-700 p-3 rounded",children:k}),B&&e.jsx(o.div,{className:"bg-green-100 text-green-700 p-3 rounded inline-flex items-center gap-2",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:280,damping:18},children:e.jsx("span",{children:"Saved"})}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(o.div,{className:"w-20 h-20 rounded-full overflow-hidden bg-love-light border border-love-pink/30 ring-2 ring-love-light/60",whileHover:{scale:1.03,rotate:1.5},transition:{type:"spring",stiffness:260,damping:18},children:p?e.jsx("img",{src:p,alt:"Avatar",loading:"lazy",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"No Image"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold text-love-dark",children:t.name||n.displayName||"No name set"}),e.jsx("div",{className:"text-sm text-gray-500",children:n.email})]})]}),d&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:s=>{var a;return L(((a=s.target.files)==null?void 0:a[0])||null)},className:"hidden"}),e.jsx(o.button,{type:"button",onClick:()=>v.current&&v.current.click(),className:"px-4 py-2 text-sm font-medium rounded-lg bg-love-light text-love-dark hover:bg-love-pink/40 transition-colors",whileTap:{scale:.95},children:"Change Photo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:t.name,onChange:m,disabled:!d}),r.name&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",name:"address",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:t.address,onChange:m,disabled:!d}),r.address&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:r.address})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Postal Code"}),e.jsx("input",{type:"text",name:"postalCode",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:t.postalCode,onChange:m,disabled:!d}),r.postalCode&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:r.postalCode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",name:"country",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:t.country,onChange:m,disabled:!d}),r.country&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:r.country})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{name:"gender",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:t.gender,onChange:m,disabled:!d,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-2xl font-cursive text-love-dark",children:"Billing Details"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Name"}),e.jsx("input",{type:"text",name:"billingName",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:t.billingName,onChange:m,disabled:!d}),r.billingName&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:r.billingName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Address"}),e.jsx("input",{type:"text",name:"billingAddress",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:t.billingAddress,onChange:m,disabled:!d}),r.billingAddress&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:r.billingAddress})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Postal Code"}),e.jsx("input",{type:"text",name:"billingPostalCode",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:t.billingPostalCode,onChange:m,disabled:!d}),r.billingPostalCode&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:r.billingPostalCode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Country"}),e.jsx("input",{type:"text",name:"billingCountry",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:t.billingCountry,onChange:m,disabled:!d}),r.billingCountry&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:r.billingCountry})]})]})]})]}),d&&e.jsx(o.button,{type:"submit",className:"w-full bg-love-red text-white py-3 rounded-lg font-medium hover:bg-red-700 transition-colors shadow-lg",whileTap:{scale:.97},whileHover:{translateY:-1},children:"Save"})]})})]}),e.jsx(o.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1,ease:[.16,1,.3,1]},children:e.jsxs(o.div,{layout:!0,className:"bg-white p-8 rounded-2xl shadow-lg border border-love-pink/20 mt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-love-dark mb-4",children:"Your Favorites"}),F.length===0?e.jsx("div",{className:"text-gray-600",children:"No favorites yet. Tap the heart on items to save them here."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:G.filter(s=>F.includes(s.id)).map((s,a)=>e.jsxs(o.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05*a},whileHover:{y:-4,boxShadow:"0 18px 35px rgba(15,23,42,0.16)"},className:"border border-love-pink/20 rounded-xl overflow-hidden bg-white shadow-sm flex flex-col",children:[e.jsx(o.img,{src:s.image,alt:s.name,className:"w-full h-40 object-cover",whileHover:{scale:1.03},transition:{type:"spring",stiffness:260,damping:22}}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"text-xs text-love-red font-medium mb-1 uppercase tracking-wider",children:s.category}),e.jsx("div",{className:"font-semibold text-gray-800",children:s.name}),e.jsxs("div",{className:"text-love-dark font-bold mt-2 mb-4",children:["$",s.price.toFixed(2)]}),e.jsx(o.button,{type:"button",onClick:()=>z(s.id),className:"mt-auto inline-flex items-center justify-center px-3 py-2 rounded-lg text-xs font-medium border border-gray-300 text-gray-700 hover:border-love-red hover:text-love-red transition-colors",whileTap:{scale:.95},children:"Remove from favorites"})]})]},s.id))})]})})]}):null}export{_ as default};
