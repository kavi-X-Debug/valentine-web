import{a as ae,r as d,q as le,o as re,w as ie,n as z,p as ne,j as e,m as c,e as N,f,g as de,v as M,B as oe,h as ce,i as me}from"./index-ydXDGJmK.js";import{M as xe}from"./products-ltJaewHY.js";function be(){const{currentUser:n}=ae(),[K,U]=d.useState(!0),[B,b]=d.useState(""),[G,w]=d.useState(!1),[l,O]=d.useState({name:"",address:"",postalCode:"",country:"",gender:"",billingName:"",billingAddress:"",billingPostalCode:"",billingCountry:""}),[v,Q]=d.useState(null),[C,T]=d.useState(""),[E,$]=d.useState([]),[m,A]=d.useState(!1),[o,Z]=d.useState({}),k=d.useRef(null),[h,S]=d.useState([]),[_,p]=d.useState(!0),[q,P]=d.useState(null),[R,F]=d.useState(null),[J,D]=d.useState(""),[I,y]=d.useState(""),[H,Y]=d.useState(!1);d.useEffect(()=>{async function t(){if(n){w(!1),b(""),U(!0);try{const a=N(f,"users",n.uid),r=await de(a),s=r.exists()?r.data():{};O({name:s.name||n.displayName||"",address:s.address||"",postalCode:s.postalCode||"",country:s.country||"",gender:s.gender||"",billingName:s.billingName||s.name||n.displayName||"",billingAddress:s.billingAddress||s.address||"",billingPostalCode:s.billingPostalCode||s.postalCode||"",billingCountry:s.billingCountry||s.country||""}),T(s.photoURL||n.photoURL||""),$(Array.isArray(s.favorites)?s.favorites:[])}catch{b("Failed to load profile")}finally{A(!1),U(!1)}}}t()},[n]),d.useEffect(()=>{if(!n){S([]),p(!1);return}p(!0);const t=le(z(f,"orders"),ie("userId","==",n.uid),re("createdAt","desc")),a=ne(t,r=>{const s=r.docs.map(i=>({id:i.id,...i.data()}));S(s),p(!1)},()=>{S([]),p(!1)});return()=>a()},[n]);function x(t){const{name:a,value:r}=t.target;O(s=>({...s,[a]:r}))}function V(){const t={},a=l.name.trim();a?a.length<2&&(t.name="Full name must be at least 2 characters"):t.name="Full name is required";const r=l.address.trim();r&&r.length<5&&(t.address="Address should be at least 5 characters");const s=l.billingName.trim();s&&s.length<2&&(t.billingName="Billing name should be at least 2 characters");const i=l.billingAddress.trim();i&&i.length<5&&(t.billingAddress="Billing address should be at least 5 characters");function u(L,j){const g=L.trim();g&&((g.length<3||g.length>10)&&(t[j]="Postal code should be 3 to 10 characters"),/^[0-9A-Za-z\- ]+$/.test(g)||(t[j]="Postal code can use letters and numbers only"))}u(l.postalCode,"postalCode"),u(l.billingPostalCode,"billingPostalCode");function W(L,j){const g=L.trim();g&&g.length<2&&(t[j]="Country name should be at least 2 characters")}return W(l.country,"country"),W(l.billingCountry,"billingCountry"),Z(t),Object.keys(t).length===0}function X(t){return new Promise((a,r)=>{const s=new FileReader;s.onload=()=>a(s.result),s.onerror=r,s.readAsDataURL(t)})}async function ee(t){if(t.preventDefault(),b(""),w(!1),!!V())try{let r=C;if(v){if(!v.type.startsWith("image/")){b("Please upload a valid image file");return}if(v.size>256*1024){b("Image too large (max 256KB)");return}r=await X(v)}const s=N(f,"users",n.uid);await M(s,{name:l.name,address:l.address,postalCode:l.postalCode,country:l.country,gender:l.gender,billingName:l.billingName,billingAddress:l.billingAddress,billingPostalCode:l.billingPostalCode,billingCountry:l.billingCountry,photoURL:r||null},{merge:!0});const i={};if(l.name&&l.name!==n.displayName&&(i.displayName=l.name),Object.keys(i).length)try{await oe(n,i)}catch{}T(r),w(!0),A(!1)}catch{b("Failed to save profile")}}async function te(t){if(n)try{const a=N(f,"users",n.uid);await ce(a,{favorites:me(t)}),$(r=>r.filter(s=>s!==t))}catch(a){console.error("Failed to remove favorite",a)}}async function se(t,a){if(!n||!t||!a)return;const r=I.trim();if(r){Y(!0);try{const s=z(f,"reviews"),u=l.name||n.displayName||""||n.email||"Anonymous";await M(N(s),{productId:a.id,productName:a.name||"",userId:n.uid,userName:u,message:r,createdAt:new Date,orderId:t.id||null}),y(""),P(null),F(null),D("")}catch(s){console.error("Failed to submit review",s)}finally{Y(!1)}}}return n?e.jsxs("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[e.jsxs(c.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},className:"relative",children:[e.jsx(c.div,{"aria-hidden":"true",className:"pointer-events-none absolute -inset-x-10 -top-10 h-40 bg-gradient-to-r from-love-light/60 via-white to-love-light/60 blur-3xl opacity-60",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.7}}),e.jsx(c.div,{layout:!0,className:"bg-white p-8 rounded-2xl shadow-lg border border-love-pink/20 relative overflow-hidden",whileHover:{y:-2},transition:{type:"spring",stiffness:260,damping:22},children:K?e.jsx("div",{className:"text-gray-600",children:"Loading..."}):e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(c.h2,{className:"text-2xl font-cursive text-love-dark",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{duration:.4},children:"Personal Details"}),e.jsx(c.button,{type:"button",onClick:()=>A(t=>!t),className:"px-4 py-2 text-sm font-medium rounded-lg border border-love-red text-love-red hover:bg-love-red hover:text-white transition-colors",whileTap:{scale:.95},whileHover:{translateY:-1},transition:{type:"spring",stiffness:300,damping:20},children:m?"Cancel":"Update Personal Details"})]}),B&&e.jsx("div",{className:"bg-red-100 text-red-700 p-3 rounded",children:B}),G&&e.jsx(c.div,{className:"bg-green-100 text-green-700 p-3 rounded inline-flex items-center gap-2",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:280,damping:18},children:e.jsx("span",{children:"Saved"})}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(c.div,{className:"w-20 h-20 rounded-full overflow-hidden bg-love-light border border-love-pink/30 ring-2 ring-love-light/60",whileHover:{scale:1.03,rotate:1.5},transition:{type:"spring",stiffness:260,damping:18},children:C?e.jsx("img",{src:C,alt:"Avatar",loading:"lazy",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:"No Image"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-semibold text-love-dark",children:l.name||n.displayName||"No name set"}),e.jsx("div",{className:"text-sm text-gray-500",children:n.email})]})]}),m&&e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("input",{ref:k,type:"file",accept:"image/*",onChange:t=>{var a;return Q(((a=t.target.files)==null?void 0:a[0])||null)},className:"hidden"}),e.jsx(c.button,{type:"button",onClick:()=>k.current&&k.current.click(),className:"px-4 py-2 text-sm font-medium rounded-lg bg-love-light text-love-dark hover:bg-love-pink/40 transition-colors",whileTap:{scale:.95},children:"Change Photo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.name,onChange:x,disabled:!m}),o.name&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:o.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",name:"address",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.address,onChange:x,disabled:!m}),o.address&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:o.address})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Postal Code"}),e.jsx("input",{type:"text",name:"postalCode",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.postalCode,onChange:x,disabled:!m}),o.postalCode&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:o.postalCode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",name:"country",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.country,onChange:x,disabled:!m}),o.country&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:o.country})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{name:"gender",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.gender,onChange:x,disabled:!m,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-100",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-2xl font-cursive text-love-dark",children:"Billing Details"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Name"}),e.jsx("input",{type:"text",name:"billingName",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.billingName,onChange:x,disabled:!m}),o.billingName&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:o.billingName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Address"}),e.jsx("input",{type:"text",name:"billingAddress",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.billingAddress,onChange:x,disabled:!m}),o.billingAddress&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:o.billingAddress})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Postal Code"}),e.jsx("input",{type:"text",name:"billingPostalCode",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.billingPostalCode,onChange:x,disabled:!m}),o.billingPostalCode&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:o.billingPostalCode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-1",children:"Billing Country"}),e.jsx("input",{type:"text",name:"billingCountry",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.billingCountry,onChange:x,disabled:!m}),o.billingCountry&&e.jsx("div",{className:"mt-1 text-xs text-red-600",children:o.billingCountry})]})]})]})]}),m&&e.jsx(c.button,{type:"submit",className:"w-full bg-love-red text-white py-3 rounded-lg font-medium hover:bg-red-700 transition-colors shadow-lg",whileTap:{scale:.97},whileHover:{translateY:-1},children:"Save"})]})})]}),e.jsx(c.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1,ease:[.16,1,.3,1]},children:e.jsxs(c.div,{layout:!0,className:"bg-white p-8 rounded-2xl shadow-lg border border-love-pink/20 mt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-love-dark mb-4",children:"Your Favorites"}),E.length===0?e.jsx("div",{className:"text-gray-600",children:"No favorites yet. Tap the heart on items to save them here."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:xe.filter(t=>E.includes(t.id)).map((t,a)=>e.jsxs(c.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.4,delay:.05*a},whileHover:{y:-4,boxShadow:"0 18px 35px rgba(15,23,42,0.16)"},className:"border border-love-pink/20 rounded-xl overflow-hidden bg-white shadow-sm flex flex-col",children:[e.jsx(c.img,{src:t.image,alt:t.name,className:"w-full h-40 object-cover",whileHover:{scale:1.03},transition:{type:"spring",stiffness:260,damping:22}}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsx("div",{className:"text-xs text-love-red font-medium mb-1 uppercase tracking-wider",children:t.category}),e.jsx("div",{className:"font-semibold text-gray-800",children:t.name}),e.jsxs("div",{className:"text-love-dark font-bold mt-2 mb-4",children:["$",t.price.toFixed(2)]}),e.jsx(c.button,{type:"button",onClick:()=>te(t.id),className:"mt-auto inline-flex items-center justify-center px-3 py-2 rounded-lg text-xs font-medium border border-gray-300 text-gray-700 hover:border-love-red hover:text-love-red transition-colors",whileTap:{scale:.95},children:"Remove from favorites"})]})]},t.id))})]})}),e.jsx(c.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,delay:.15,ease:[.16,1,.3,1]},children:e.jsxs(c.div,{layout:!0,className:"bg-white p-8 rounded-2xl shadow-lg border border-love-pink/20 mt-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-love-dark mb-4",children:"Your Orders"}),_?e.jsx("div",{className:"text-gray-600 text-sm",children:"Loading your orders..."}):h.length===0?e.jsx("div",{className:"text-gray-600 text-sm",children:"You have not placed any orders yet."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"In progress"}),e.jsxs("div",{className:"space-y-3",children:[h.filter(t=>(t.status||"pending")!=="delivered").length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No active orders."}),h.filter(t=>(t.status||"pending")!=="delivered").map(t=>{const a=(t.status||"pending").toLowerCase(),r=t.createdAt&&t.createdAt.toDate?t.createdAt.toDate().toLocaleString():"—",s=Number(t.total||0).toFixed(2);return e.jsxs("div",{className:"flex items-center justify-between border border-gray-100 rounded-xl px-4 py-3 bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-mono text-gray-500 truncate max-w-[180px]",children:t.id}),e.jsx("div",{className:"text-sm text-gray-700",children:r})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs",children:[e.jsxs("div",{className:"font-semibold text-love-dark",children:["$",s]}),e.jsx("div",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-medium "+(a==="pending"?"bg-yellow-100 text-yellow-800":a==="processing"?"bg-blue-100 text-blue-800":a==="shipped"?"bg-indigo-100 text-indigo-800":a==="cancelled"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:a[0].toUpperCase()+a.slice(1)})]})]},t.id)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Completed orders"}),e.jsxs("div",{className:"space-y-4",children:[h.filter(t=>(t.status||"pending")==="delivered").length===0&&e.jsx("div",{className:"text-xs text-gray-500",children:"No completed orders yet."}),h.filter(t=>(t.status||"pending")==="delivered").map(t=>{const a=t.createdAt&&t.createdAt.toDate?t.createdAt.toDate().toLocaleString():"—",r=Number(t.total||0).toFixed(2),s=Array.isArray(t.items)?t.items:[];return e.jsxs("div",{className:"border border-gray-100 rounded-2xl p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-mono text-gray-500 truncate max-w-[220px]",children:t.id}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Placed on ",a]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-love-dark",children:["$",r]}),e.jsx("div",{className:"text-[11px] text-green-700 bg-green-100 inline-flex px-2 py-0.5 rounded-full mt-1",children:"Delivered"})]})]}),s.length>0&&e.jsx("div",{className:"space-y-3",children:s.map((i,u)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg overflow-hidden border border-gray-200 flex-shrink-0 bg-white",children:i.image?e.jsx("img",{src:i.image,alt:i.name||"Item",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-[10px] text-gray-400",children:"No image"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800 truncate",children:i.name||"Item"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Qty ",i.quantity||1," • $",Number(i.price||0).toFixed(2)]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1",children:e.jsx("button",{type:"button",onClick:()=>{P(t.id),F(i.id),D(i.name||""),y("")},className:"px-3 py-1.5 rounded-lg border border-gray-300 text-xs font-medium text-gray-700 hover:border-love-red hover:text-love-red transition-colors",children:q===t.id&&R===i.id?"Writing...":"Write review"})})]},`${t.id}-${u}`))}),q===t.id&&R&&e.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-700 mb-1",children:["Review for ",J||"item"]}),e.jsx("textarea",{rows:3,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",placeholder:"Write a short message about this item...",value:I,onChange:i=>y(i.target.value)}),e.jsxs("div",{className:"mt-2 flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{P(null),F(null),D(""),y("")},className:"px-3 py-1.5 rounded-lg border border-gray-300 text-xs text-gray-600 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",disabled:H||!I.trim(),onClick:()=>{const i=(Array.isArray(t.items)?t.items:[]).find(u=>u&&u.id===R);se(t,i)},className:"px-4 py-1.5 rounded-lg bg-love-red text-white text-xs font-medium hover:bg-red-700 disabled:opacity-60 disabled:cursor-not-allowed",children:H?"Saving...":"Submit review"})]})]})]},t.id)})]})]})]})]})})]}):null}export{be as default};
