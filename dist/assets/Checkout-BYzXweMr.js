import{u as N,a as w,b as k,r as c,j as e,m as P,s as C,t as T,n as S,f as b,e as L,v as F,x as R}from"./index-Cijh6fBT.js";const E=()=>{if(!(typeof localStorage>"u"))return{get:s=>Promise.resolve(localStorage.getItem(s)),set:(s,o)=>Promise.resolve(localStorage.setItem(s,o)),remove:s=>Promise.resolve(localStorage.removeItem(s))}},H={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:E()};function _(){const{cartItems:s,cartTotal:o,clearCart:f}=N(),{currentUser:n}=w(),l=k(),[p,x]=c.useState(!1),[g,d]=c.useState(""),[t,h]=c.useState({firstName:"",lastName:"",email:(n==null?void 0:n.email)||"",address:"",city:"",zipCode:"",country:"",cardNumber:"",expiryDate:"",cvv:""}),a=r=>{h({...t,[r.target.name]:r.target.value})},y=async r=>{if(r.preventDefault(),!n){d("Please log in to place an order."),l("/login");return}x(!0),d("");try{const m={userId:n?n.uid:"guest",userEmail:t.email,items:s,total:o,shippingDetails:{firstName:t.firstName,lastName:t.lastName,address:t.address,city:t.city,zipCode:t.zipCode,country:t.country},status:"pending",createdAt:C()},v=await T(S(b,"orders"),m);try{const i=Number(o);if(!Number.isNaN(i)&&i!==0){const u=L(b,"stats","global");await F(u,{totalRevenue:R(i)},{merge:!0})}}catch(i){console.error("Failed to update revenue stats after order creation",i)}try{const i={order_id:v.id,to_name:`${t.firstName} ${t.lastName}`,to_email:t.email,message:`Thank you for your order! Your total is $${o.toFixed(2)}. We will ship your romantic gifts to ${t.address}, ${t.city}.`,reply_to:"support@lovecraft.com"},u=void 0,j=void 0,q="GNdiN4DMl_vTXQ7iE";u&&j||console.warn("EmailJS service/template IDs are not set"),console.log("Email sent successfully!")}catch(i){console.error("Failed to send email:",i)}f(),l("/order-success")}catch(m){console.error("Error placing order:",m),d("Failed to place order. Please try again.")}finally{x(!1)}};return c.useEffect(()=>{s.length===0&&l("/cart")},[s,l]),s.length===0?null:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h1",{className:"text-4xl font-cursive text-love-dark mb-8 text-center",children:"Checkout"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12",children:[e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-md border border-love-pink/20",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-800",children:"Shipping Details"}),g&&e.jsx("div",{className:"bg-red-100 text-red-700 p-3 rounded mb-4",children:g}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),e.jsx("input",{type:"text",name:"firstName",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.firstName,onChange:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),e.jsx("input",{type:"text",name:"lastName",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.lastName,onChange:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.email,onChange:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("input",{type:"text",name:"address",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.address,onChange:a})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),e.jsx("input",{type:"text",name:"city",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.city,onChange:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Zip Code"}),e.jsx("input",{type:"text",name:"zipCode",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.zipCode,onChange:a})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country"}),e.jsx("input",{type:"text",name:"country",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.country,onChange:a})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-100",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-800",children:"Payment Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Number"}),e.jsx("input",{type:"text",name:"cardNumber",required:!0,placeholder:"0000 0000 0000 0000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.cardNumber,onChange:a})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),e.jsx("input",{type:"text",name:"expiryDate",required:!0,placeholder:"MM/YY",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.expiryDate,onChange:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CVV"}),e.jsx("input",{type:"text",name:"cvv",required:!0,placeholder:"123",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-love-red focus:border-transparent outline-none",value:t.cvv,onChange:a})]})]})]})]}),e.jsx("button",{type:"submit",disabled:p,className:"w-full bg-love-red text-white py-3 rounded-lg font-medium hover:bg-red-700 transition-colors shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Processing...":`Pay $${o.toFixed(2)}`})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl border border-gray-200 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-800",children:"Order Summary"}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:s.map(r=>e.jsxs("div",{className:"flex gap-4 border-b border-gray-200 pb-4",children:[e.jsx("img",{src:r.image,alt:r.name,loading:"lazy",className:"w-16 h-16 object-cover rounded-md"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",r.quantity]}),e.jsxs("p",{className:"text-love-red font-medium",children:["$",r.price.toFixed(2)]}),r.customText&&e.jsxs("p",{className:"text-xs text-gray-500 italic mt-1",children:['"',r.customText,'"']})]})]},`${r.id}-${r.customText}`))}),e.jsxs("div",{className:"mt-6 space-y-2 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",o.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:"Free"})]}),e.jsxs("div",{className:"flex justify-between font-bold text-xl text-love-dark pt-2",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",o.toFixed(2)]})]})]})]})})]})]})})}export{_ as default};
